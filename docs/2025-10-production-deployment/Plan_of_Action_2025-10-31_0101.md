# MVP Production-Ready Implementation Plan

**Date:** 2025-10-31 01:01  
**Goal:** Complete MVP implementation and deploy to Vercel production  
**Status:** 2 critical fixes needed before production deployment

---

## MCP Server Connection Test Results (After Restart)

**Test Date:** October 31, 2025 (After Restart)

#### ✅ Filesystem MCP - WORKING
- **Status:** ✅ Active
- **Test:** `mcp_filesystem_list_allowed_directories` - Success
- **Available Tools:** File operations, directory listing

#### ⚠️ GitHub MCP - TOKEN ISSUE (401 Bad Credentials)
- **Status:** ⚠️ Connection Failed
- **Test:** `mcp_GitHub_get_me` - Failed with 401 Bad Credentials
- **Issue:** GitHub Personal Access Token is invalid or expired
- **Action Required:** 
  - Regenerate token at https://github.com/settings/tokens
  - Required scopes: `repo`, `read:org`, `workflow`
  - Update `.mcp.json` with new token
  - Restart Cursor/Claude again

#### ✅ Supabase MCP - WORKING (Verified by User)
- **Status:** ✅ Confirmed Working
- **Configuration:** Uses `SUPABASE_ACCESS_TOKEN` env var (correct format)
- **Token:** Configured and working
- **Action Required:** None - ready to use for database operations

#### ❓ Whop MCP - NEEDS TESTING
- **Status:** ✅ Server File Exists
- **Server Path:** `C:\Users\jimmy\.mcp\servers\whop\index.ts` ✅ EXISTS
- **Configuration:** Uses `WHOP_API_KEY` env var ✅
- **API Key:** Verified in .env.local
- **Action Required:** 
  - Test Whop API connection by calling a Whop MCP tool
  - If tools don't appear, check MCP server logs for errors

### MCP Server Summary After Restart:
- ✅ **Filesystem MCP**: Working
- ✅ **Supabase MCP**: Working (User confirmed)
- ⚠️ **GitHub MCP**: Needs token regeneration (401 error)
- ❓ **Whop MCP**: Server file exists, needs connection test

---

## MCP Server Verification Status

### Current Configuration
- **Configuration File:** `.mcp.json` exists ✅
- **Servers Configured:** 5 servers
  1. Supabase MCP (`@supabase/mcp-server-supabase`)
  2. GitHub MCP (`@modelcontextprotocol/server-github`)
  3. Whop MCP (Custom server at `C:\Users\jimmy\.mcp\servers\whop\index.ts`)
  4. Desktop Commander (`@wonderwhy-er/desktop-commander`)
  5. n8n-mcp (Custom server - currently disabled.)

### Verification Results & Fixes Applied

#### ✅ Filesystem MCP - WORKING
- **Status:** ✅ Active
- **Test:** `mcp_filesystem_list_allowed_directories` - Success
- **Available Tools:** File operations, directory listing

#### ✅ GitHub MCP - CONFIGURED (NEEDS RESTART)
- **Status:** ✅ Configuration Fixed
- **Fix Applied:** Added `@latest` to package name for consistency
- **Configuration:** Uses `GITHUB_PERSONAL_ACCESS_TOKEN` env var
- **Action Required:** 
  - **Restart Cursor/Claude** to reload MCP config
  - Test with `mcp_GitHub_get_me` after restart
  - If still fails, regenerate token at https://github.com/settings/tokens

#### ✅ Supabase MCP - WORKING
- **Status:** ✅ Verified Working (User Confirmed)
- **Configuration:** Uses `SUPABASE_ACCESS_TOKEN` env var (correct format)
- **Token:** Configured and working
- **Action Required:** None - ready to use

#### ❓ Whop MCP - CONFIGURED (NEEDS RESTART)
- **Status:** ✅ Configuration Verified
- **Server Path:** `C:\Users\jimmy\.mcp\servers\whop\index.ts` ✅ EXISTS
- **Configuration:** Uses `WHOP_API_KEY` env var ✅
- **API Key:** Verified in .env.local
- **Action Required:** 
  - **Restart Cursor/Claude** to reload MCP config
  - Test Whop API connection after restart

---

## Critical Fixes (Must Complete Before Deployment)

### 1. Fix Chunking Timestamp Validation Issue

**File:** `lib/video/chunking.ts` (lines 160-179)

**Problem:**
- Manual `chunkStartTime` tracking drifts after chunk 3
- Causes validation failures: `startTimestamp > endTimestamp`
- Affects video processing completion for PRO+ tier custom uploads
- Does NOT affect BASIC tier pre-loaded videos (already processed)

**Solution:**
- Remove manual `chunkStartTime` tracking in `createChunk()` method
- Use segment timestamps directly from the segments array
- Fix logic: `startTimestamp = segments[0].start`, `endTimestamp = segments[segments.length - 1].end`
- Ensure proper segment filtering per chunk (segments array contains ALL segments, need to filter)

**Implementation Steps:**
1. Review `lib/video/chunking.ts` `createChunk()` method
2. Fix timestamp calculation to use segments array directly
3. Ensure segments are properly filtered per chunk (not all segments)
4. Remove diagnostic logging added for debugging
5. Test with YouTube video import
6. Verify chunk validation passes for all chunks

**MCP Tools:**
- Use GitHub MCP to create branch and commit fix (⚠️ Fix GitHub token first)
- Use Supabase MCP to verify database chunk insertions work correctly (❓ Test first)

**Estimated Time:** 30-45 minutes

---

### 2. Integrate Usage Tracking UI into Creator Dashboard

**Files:**
- `app/dashboard/creator/page.tsx` - Main dashboard page
- `components/usage/UsageDashboard.tsx` - Usage tracking component (already exists)

**Problem:**
- UsageDashboard component exists but not integrated into Creator Dashboard
- Creator Dashboard shows analytics but no usage/cost tracking
- PRO+ users need to see API costs and usage limits

**Solution:**
- Import UsageDashboard component into Creator Dashboard
- Add usage tracking section/widget
- Fetch usage stats using existing API endpoints (`/api/usage/stats`)
- Display cost meters and breakdown charts
- Show tier limits and current spending

**Implementation Steps:**
1. Review `app/dashboard/creator/page.tsx` structure
2. Import `UsageDashboard` component from `components/usage/UsageDashboard.tsx`
3. Add usage tracking section to dashboard layout
4. Fetch creator ID from auth context (currently using mock)
5. Pass creator ID to UsageDashboard component
6. Style integration to match existing dashboard design
7. Test with PRO/ENTERPRISE tier users
8. Verify cost tracking displays correctly

**MCP Tools:**
- Use Whop MCP to verify user tier for PRO/ENTERPRISE users (❓ Test first)
- Use Supabase MCP to verify usage data exists in database (❓ Test first)

**Estimated Time:** 1-2 hours

---

## Pre-Deployment Verification

### 3. Fix GitHub MCP Authentication

**Issue:** GitHub MCP returning 401 Bad Credentials

**Steps:**
1. Check current token in `.mcp.json`
2. Verify token exists and has correct permissions
3. Regenerate token at https://github.com/settings/tokens if needed
4. Update `.mcp.json` with new token
5. Restart Cursor/Claude to reload MCP config
6. Test with `mcp_GitHub_get_me`

**Estimated Time:** 10 minutes

---

### 4. Verify Supabase MCP Connection

**Current Config Issue:**
- Uses `SUPABASE_ACCESS_TOKEN` (non-standard)
- Standard Supabase MCP needs `SUPABASE_URL` + `SUPABASE_SERVICE_ROLE_KEY`

**Steps:**
1. Check if Supabase MCP tools are available
2. Try simple query to test connection
3. If fails, update `.mcp.json` with correct env vars:
   ```json
   "env": {
     "SUPABASE_URL": "https://yourproject.supabase.co",
     "SUPABASE_SERVICE_ROLE_KEY": "your_service_role_key"
   }
   ```
4. Restart Cursor/Claude
5. Test connection again

**Estimated Time:** 15 minutes

---

### 5. Verify Whop MCP Connection

**Steps:**
1. Verify Whop server file exists (✅ Confirmed: `C:\Users\jimmy\.mcp\servers\whop\index.ts`)
2. Check if Whop MCP tools are available (should start with `mcp__whop__*`)
3. Test with simple Whop API call (e.g., get company info)
4. Verify `WHOP_API_KEY` is valid
5. Check server logs for any errors

**Estimated Time:** 15 minutes

---

### 6. Environment Variables Verification

**MCP Tools:**
- Use Supabase MCP to verify database connection (after fixing config)
- Use Whop MCP to verify API key and webhook configuration (after testing)

**Checklist:**
- [ ] All 48 environment variables documented in Vercel
- [ ] Supabase connection verified via MCP (after fix)
- [ ] Whop API key validated via MCP (after test)
- [ ] OpenAI API keys configured
- [ ] Webhook secrets verified

**Estimated Time:** 15 minutes (after MCP fixes)

---

### 7. Database Migration Verification

**MCP Tools:**
- Use Supabase MCP to verify all migrations applied (after fixing config)
- Check materialized views are refreshed
- Verify RLS policies are active

**Checklist:**
- [ ] All 27 migrations applied (`supabase/migrations/`)
- [ ] `video_analytics` materialized view exists and refreshed
- [ ] `most_asked_questions` view exists
- [ ] RLS policies enforce creator isolation
- [ ] Indexes optimized for performance

**Estimated Time:** 15 minutes (after Supabase MCP fix)

---

### 8. MVP Feature Testing

**Test Each MVP Feature:**

1. **Whop Integration** (All tiers)
   - [ ] OAuth login works
   - [ ] Membership validation works
   - [ ] Webhook processing works
   - Use Whop MCP to verify webhook endpoints (after testing)

2. **Video Upload & Content Creation** (BASIC: pre-loaded, PRO+: custom)
   - [ ] BASIC tier sees 4 pre-loaded videos
   - [ ] PRO+ tier can upload custom videos
   - [ ] Course creation works (PRO+)

3. **Video Processing & RAG Database** (BASIC: pre-loaded, PRO+: custom)
   - [ ] BASIC tier pre-loaded videos work in chat
   - [ ] PRO+ custom video processing completes successfully
   - [ ] Chunking fix verified (no timestamp validation errors)
   - Use Supabase MCP to verify chunks in database (after fixing config)

4. **AI Chat Feature** (BASIC: 7-day trial, PRO+: unlimited)
   - [ ] BASIC tier 7-day trial works
   - [ ] PRO+ unlimited chat works
   - [ ] Video citations appear correctly
   - [ ] RAG search returns relevant results

5. **Creator Dashboard** (PRO+ only)
   - [ ] Dashboard loads correctly
   - [ ] Analytics display correctly
   - [ ] Video summaries show popular videos
   - [ ] Usage tracking integrated and displays costs
   - Use Supabase MCP to verify analytics data (after fixing config)

**Estimated Time:** 2-3 hours

---

## Deployment to Vercel

### 9. Pre-Deployment Checklist

**MCP Tools:**
- Use GitHub MCP to verify code is committed (after fixing token)
- Use GitHub MCP to create release tag (after fixing token)

**Checklist:**
- [ ] All critical fixes committed
- [ ] TypeScript compilation passes (`npx tsc --noEmit`)
- [ ] ESLint passes (`npm run lint`)
- [ ] Tests pass (`npm test`)
- [ ] Build succeeds (`npm run build`)
- [ ] No console.logs in production code
- [ ] Environment variables configured in Vercel dashboard
- [ ] Health check endpoint works (`/api/health`)

**Estimated Time:** 30 minutes

---

### 10. Deploy to Vercel Production

**MCP Tools:**
- Use GitHub MCP to push to main branch (triggers Vercel deployment) (after fixing token)
- Use GitHub MCP to verify deployment status (after fixing token)

**Steps:**
1. Push code to main branch
2. Vercel automatically deploys (CI/CD configured)
3. Monitor deployment logs
4. Verify deployment URL works
5. Test production endpoints

**Estimated Time:** 15 minutes (deployment) + 30 minutes (verification)

---

### 11. Post-Deployment Verification

**MCP Tools:**
- Use Whop MCP to verify webhook endpoints receive events (after testing)
- Use Supabase MCP to verify database connections (after fixing config)
- Use GitHub MCP to create deployment issue if problems found (after fixing token)

**Checklist:**
- [ ] Production URL accessible
- [ ] OAuth login works
- [ ] Video upload works (PRO+)
- [ ] Chat works (all tiers)
- [ ] Creator Dashboard loads (PRO+)
- [ ] Usage tracking displays (PRO+)
- [ ] Webhook endpoints receive events
- [ ] No critical errors in logs
- [ ] Performance metrics acceptable

**Estimated Time:** 1 hour

---

## Documentation Updates

### 12. Update Deployment Documentation

**Files to Update:**
- `docs/2025-10-production-deployment/README.md`
- `docs/2025-10-production-deployment/MVP_FEATURE_INVENTORY_2025-10-31_0038.md`

**Updates:**
- Mark chunking fix as complete
- Mark usage tracking integration as complete
- Update production deployment status
- Document any issues encountered
- Document MCP server verification results

**Estimated Time:** 15 minutes

---

## Summary

**Total Estimated Time:** 7-9 hours (includes MCP server fixes)

**Critical Path:**
1. Fix GitHub MCP authentication (10 min)
2. Fix Supabase MCP configuration (15 min)
3. Test Whop MCP connection (15 min)
4. Fix chunking timestamp validation (30-45 min)
5. Integrate usage tracking UI (1-2 hours)
6. Pre-deployment verification (30 min)
7. Deploy to Vercel (45 min)
8. Post-deployment verification (1 hour)

**MCP Servers Status:**
- ✅ **Filesystem MCP**: Working
- ✅ **Supabase MCP**: Working (Verified by user)
- ⚠️ **GitHub MCP**: Needs token verification after restart
- ❓ **Whop MCP**: Needs connection test after restart

**Success Criteria:**
- All 5 MVP features operational in production
- BASIC tier works with 4 pre-loaded videos + 7-day trial
- PRO+ tier works with Creator Dashboard + usage tracking
- No critical errors in production logs
- Whop integration functional
- Video processing completes successfully
- All MCP servers verified and working

---

## MCP Server Priority & Status

### Priority 1: Supabase MCP ✅ WORKING
- **Status:** ✅ Confirmed Working (User verified)
- **Purpose:** Database verification, migrations, RLS policies, data integrity checks
- **Action:** Use for all database-related verification tasks
- **Ready:** Yes - can proceed with Supabase integration tasks

### Priority 2: Whop MCP ⚠️ NEEDS FIXING
- **Status:** ⚠️ Server file exists but tools not loading
- **Purpose:** Whop API integration, tier verification, webhook validation
- **Action Required:** Troubleshoot server loading issues
- **Timeline:** Fix after Supabase integration tasks complete

### Priority 3: GitHub MCP ⏭️ SKIP (Unless WorkTrees Needed)
- **Status:** ⚠️ Token issue (401 error)
- **Purpose:** Git operations, deployment automation
- **Action:** Skip for now - only fix if WorkTrees needed
- **Note:** Manual git operations can be used instead

---

## Immediate Next Steps

### 1. Proceed with Supabase MCP Integration (Priority 1) ✅
- ✅ Supabase MCP is working and ready
- Use for database verification tasks:
  - Verify migrations applied
  - Check materialized views exist and refreshed
  - Verify RLS policies enforce creator isolation
  - Test chunk insertions after chunking fix
  - Verify usage tracking data structure

### 2. Fix Whop MCP After Supabase Tasks (Priority 2) ⚠️
**Whop MCP Status:**
- ✅ Server file exists: `C:\Users\jimmy\.mcp\servers\whop\index.ts`
- ✅ node_modules exists (dependencies installed)
- ✅ package.json configured with tsx dependency
- ⚠️ Tools not appearing in Cursor/Claude

**Troubleshooting Steps (After Supabase tasks):**
1. Check Cursor/Claude MCP logs for Whop server errors
2. Verify environment variable `WHOP_API_KEY` is accessible
3. Test server manually: `cd C:\Users\jimmy\.mcp\servers\whop && npm run start`
4. Check if tsx needs to be installed globally: `npm install -g tsx`
5. Verify MCP server is registered correctly in `.mcp.json`

**Once Whop MCP is working:**
- Use for Whop API verification
- Verify user tiers (PRO/ENTERPRISE)  
- Test webhook endpoints
- Validate Whop integration throughout app

### 3. Skip GitHub MCP ⏭️
- Only fix if WorkTrees needed for deployment
- Use manual git operations for now
- Can be fixed later if needed

---

**Document Created:** October 31, 2025 01:01  
**Next Review:** After MCP server verification and fixes  

